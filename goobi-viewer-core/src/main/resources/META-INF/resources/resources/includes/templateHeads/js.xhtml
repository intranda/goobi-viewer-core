<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:jsf="http://xmlns.jcp.org/jsf">

	<!-- ===============================
        BASE LIBRARIES + CORE MODULES
    ================================ -->
	<!--
        `jsPaths` contains one array for each javascript library,
        each array contains
        - an identifier that allows excluding libraries from viewer theme template files
        - an array of templates to exclude (or empty),
        - a path to the library file:
        [
          name,
          [don't, render, library, here ],
          path/to/lib
        ]
    -->

	<c:set var="jsPaths"
		value="#{[

      ['jquery',
        [],
        'resources/javascript/libs/jquery/jquery.min.js'
      ],
      ['jqueryUI',
        ['templateBlankUnstyled'],
        'resources/javascript/libs/jqueryUi/jquery-ui.min.js'
      ],
      ['jqueryUI.touchPunch',
        ['templateAdmin', 'templateCrowdsourcing', 'templateBlankUnstyled', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/jqueryUi/plugins/jquery.ui.touch-punch.min.js'
      ],
      ['jqueryUI.slider',
        ['templateAdmin', 'templateBlank', 'templateCrowdsourcing', 'templateBlankUnstyled', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/jqueryUi/plugins/jquery.ui.slider-1.12.1-rtl.js'
      ],
      ['bootstrap',
        [],
        'resources/javascript/libs/bs/bootstrap.bundle.min.js'
      ],
      ['tinymce',
        [ 'template', 'templateBlankUnstyled', 'templateFullscreen'],
        'resources/javascript/libs/tinymce/tinymce.min.js'
      ],
      ['datatables',
        ['templateAdmin', 'templateCrowdsourcing', 'templateBlankUnstyled', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/datatables.min.js'
      ],
      ['reactiveX',
        [],
        'resources/javascript/libs/reactiveX/rxjs.umd.min.js'
      ],
      ['pdfJS',
        ['templateAdmin', 'templateCrowdsourcing', 'templateBlankUnstyled', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/pdfjs/pdf.js'
      ],
      ['intersectionObsPolyfill',
        ['template', 'templateAdmin', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateBlankUnstyled'],
        'resources/javascript/libs/intersection-observer_polyfill.js'
      ],
      ['riot',
        [],
        'resources/javascript/libs/riot/riot.min.js'
      ],
      ['swiper',
        ['templateCrowdsourcing', 'templateBlankUnstyled', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/swiper/swiper-bundle.min.js'
      ],
      ['sweetalert',
        [],
        'resources/javascript/libs/sweetalert/sweetalert2.min.js'
      ],
      ['hcSticky',
        ['templateBlank', 'templateCrowdsourcing', 'templateBlankUnstyled'],
        'resources/javascript/libs/hcsticky/hc-sticky.js'
      ],
      ['leaflet',
        ['templateBlankUnstyled'],
        'resources/javascript/libs/leaflet/leaflet.js'
      ],
      ['leflet.extra-markers',
        ['templateBlankUnstyled'],
        'resources/javascript/libs/leaflet/extra-markers/leaflet.extra-markers.min.js'
      ],
      ['leaflet.markercluster',
        ['templateBlankUnstyled'],
        'resources/javascript/libs/leaflet/markercluster/leaflet.markercluster.js'
      ],
      ['leaflet.draw',
        ['templateAdmin', 'templateBlank', 'templateCrowdsourcing', 'templateBlankUnstyled', 'templateArchives'],
        'resources/javascript/libs/leaflet/draw/leaflet.draw.js'
      ],
      ['mapbox.gl-geocoder',
        ['templateAdmin', 'templateBlank', 'templateBlankUnstyled', 'templateArchives'],
        'resources/javascript/libs/mapbox/geocoder/mapbox-gl-geocoder.min.js'
      ],
      ['mapbox.gl',
        ['templateAdmin', 'templateBlank', 'templateBlankUnstyled', 'templateArchives'],
        'resources/javascript/libs/mapbox/mapbox-gl.js'
      ],
      ['mirador',
        ['template', 'templateAdmin', 'templateBlank', 'templateCrowdsourcing', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/mirador/mirador.min.js'
      ],
      ['openSeadragon',
        ['templateAdmin', 'templateBlank', 'templateBlankUnstyled'],
        'resources/javascript/libs/openseadragon/openseadragon.min.js'
      ],
      ['chartjs',
        ['templateBlankUnstyled'],
        'resources/javascript/libs/chartjs/chart.umd.js'
      ],
      ['luxon',
        ['templateBlankUnstyled'],
        'resources/javascript/libs/chartjs/luxon/luxon.js'
      ],
      ['chartjs-adapter-luxon',
        ['templateBlankUnstyled'],
        'resources/javascript/libs/chartjs/chartjs-adapter-luxon/chartjs-adapter-luxon.umd.min.js'
      ],
      ['browsersupport',
        [],
        'resources/javascript/dist/browsersupport.min.js'
      ],
      ['codemirror',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/codemirror.js'
      ],
      
      ['codemirrorFullscreen',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/fullscreen.js'
      ],
      ['codemirrorProperties',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/properties.js'
      ],
      ['codemirrorXML',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/xml.js'
      ],
      ['codemirrorJS',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/javascript.js'
      ],
      ['codemirrorCSS',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/css.js'
      ],
      ['codemirrorSearch',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/search.js'
      ],
      ['codemirrorSearchCursor',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/searchcursor.js'
      ],
      ['codemirrorMatchHighlighter',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/match-highlighter.js'
      ], 
      ['codemirrorDialog',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/dialog.js'
      ],
      ['codemirrorJumpToLine',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/jump-to-line.js'
      ],
      ['codemirrorActiveLine',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/codemirror/active-line.js'
      ],
      ['lightbox',
        ['templateAdmin', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlankUnstyled'],
        'resources/javascript/libs/simpleLightbox/simpleLightbox.min.js'
      ],
      ['simplebar',
        ['templateAdmin', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateBlankUnstyled'],
        'resources/javascript/libs/simplebar/simplebar.min.js'
      ],
      ['jszip',
        ['templateAdmin', 'templateArchives', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlank'],
        'resources/javascript/libs/jszip/jszip.min.js'
      ],
      ['epubjs',
        ['templateAdmin', 'templateArchives', 'templateCrowdsourcing', 'templateFullscreen', 'templateBlank'],
        'resources/javascript/libs/epubjs/epub.min.js'
      ],
      ['viewerJS',
        [],
        'resources/javascript/dist/viewer.min.js'
      ],
      ['imageView',
        ['template', 'templateAdmin', 'templateBlank', 'templateFullscreen'],
        'resources/js/dist/imageView.min.js'
      ],
      ['riotTags',
        ['templateBlankUnstyled'],
        'resources/javascript/dist/riot-tags.js'
      ]

    ]}" />

	<!-- INCLUDE FILES IF CONDITIONS ARE MET -->
	<c:forEach var="path" items="#{jsPaths}">
		<!-- include file, if it is not explicitly excluded -->
		<!-- (either above, or in the excludeJS variable, which can be set in template files) -->
		<c:if
			test="#{!path[1].contains(templateName) and !excludeJS.contains(path[0])}">
			<script type="text/javascript"
				src="#{request.contextPath}/#{path[2]}?${navigationHelper.buildVersion}&amp;#{cacheBuster}"></script>
		</c:if>
	</c:forEach>

	<script type="text/javascript">
		(function assignViewerConfigBasePath() {
			var contextPath = '#{request.contextPath}';
			if (!contextPath || contextPath.length === 0) {
				contextPath = '/';
			}
			if (contextPath.charAt(contextPath.length - 1) !== '/') {
				contextPath += '/';
			}

			window.viewerConfig = window.viewerConfig || {};
			if (!window.viewerConfig.iconBasePath) {
				window.viewerConfig.iconBasePath = contextPath;
			}
			if (!window.viewerConfig.contextPath) {
				window.viewerConfig.contextPath = contextPath;
			}
		})();
	</script>

	<!-- SHOW AVAILABLE LIBS AND SCRIPTS IN CONSOLE -->
	<!-- an easy way to log library names to the console, just pass `showCSS` to the excludeCSS variable in a template file -->
	<c:if test="#{excludeJS.contains('showJS')}">
		<c:forEach var="path" items="#{jsPaths}">
			<script>
				console
						.log('%c#{path[0]}',
								'background: #3365a9; color: #fff; padding: 2px 6px; border-radius: 2px;')
			</script>
		</c:forEach> 
	</c:if>

</ui:composition>

<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:component="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:util="http://goobi.io/util">

    <composite:interface>
	    <!-- activates a megamenu which takes the fullwidth of the page -->
	    <composite:attribute name="megaMenu" required="false" default="false" />
	</composite:interface>
	
	<composite:implementation>
	    <nav id="#{cc.clientId}" class="navigation" aria-label="#{msg.aria_label__nav_main}">
	        <h:form id="navigationForm" prependId="false">
	            <ul class="navigation__list -level-0 navigation__main-menu">
	                <!-- STANDARD MENU -->
	                <h:panelGroup rendered="#{cc.attrs.megaMenu == false}">
	                    <ui:repeat var="navItem" value="#{cmsBean.navigationMenuItems}">
	                        <h:panelGroup rendered="#{navItem.valid and navItem.shouldDisplay}">
	                            <li class="#{!navItem.activeChildItems.isEmpty() ? 'navigation__submenu-trigger' : ''} #{navItem.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                <!-- WITHOUT SUBMENU -->
	                                <h:panelGroup rendered="#{navItem.activeChildItems.isEmpty()}">
	                                    <component:navigationLink navItem="#{navItem}" />
	                                </h:panelGroup>
	                                <!-- WITH SUBMENU -->
	                                <h:panelGroup rendered="#{!navItem.activeChildItems.isEmpty()}">
	                                    <button type="button" class="btn btn--clean" data-toggle="submenu">
	                                        #{msg[navItem.itemLabel]}
	                                        <span class="caret"></span>
	                                    </button>
	                                </h:panelGroup>
	                                <h:panelGroup rendered="#{!navItem.activeChildItems.isEmpty()}">
	                                    <ui:param name="parentItem" value="#{navItem}" />
	
	                                    <!-- LEVEL 1 -->
	                                    <div class="navigation__submenu level-1">
	                                        <ul class="navigation__list -level-1">
	                                            <ui:repeat varStatus="count" var="child" value="#{parentItem.activeChildItems}">
	                                                <h:panelGroup rendered="#{child.valid and child.shouldDisplay}">
	                                                    <li class="#{!navItem.activeChildItems.isEmpty() ? 'navigation__submenu-trigger' : ''} #{navItem.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                                        <!-- WITHOUT SUBMENU -->
	                                                        <h:panelGroup rendered="#{child.activeChildItems.isEmpty()}">
	                                                            <component:navigationLink navItem="#{child}" />
	                                                        </h:panelGroup>
	                                                        <!-- WITH SUBMENU -->
	                                                        <h:panelGroup rendered="#{!child.activeChildItems.isEmpty()}">
	                                                            <button type="button" class="btn btn--clean"
	                                                                data-toggle="submenu">
	                                                                #{msg[child.itemLabel]}
	                                                                <span class="caret"></span>
	                                                            </button>
	                                                        </h:panelGroup>
	                                                        <h:panelGroup rendered="#{!child.activeChildItems.isEmpty()}">
	                                                            <!-- LEVEL 2 -->
	                                                            <div class="navigation__submenu level-2">
	                                                                <ul class="navigation__list -level-2">
	                                                                    <ui:repeat varStatus="count" var="child1" value="#{child.activeChildItems}">
	                                                                        <h:panelGroup rendered="#{child1.valid and child1.shouldDisplay}">
	                                                                            <li class="#{!navItem.activeChildItems.isEmpty() ? 'navigation__submenu-trigger' : ''} #{navItem.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                                                                <!-- WITHOUT SUBMENU -->
	                                                                                <h:panelGroup rendered="#{child1.activeChildItems.isEmpty()}">
	                                                                                    <component:navigationLink navItem="#{child1}" />
	                                                                                </h:panelGroup>
	                                                                                <!-- WITH SUBMENU -->
	                                                                                <h:panelGroup rendered="#{!child1.activeChildItems.isEmpty()}">
	                                                                                    <button type="button"
	                                                                                        class="btn btn--clean"
	                                                                                        data-toggle="submenu">
	                                                                                        #{msg[child1.itemLabel]}
	                                                                                        <span class="caret"></span>
	                                                                                    </button>
	                                                                                </h:panelGroup>
	                                                                                <h:panelGroup rendered="#{!child1.activeChildItems.isEmpty()}">
	                                                                                    <!-- LEVEL 3 -->
	                                                                                    <div class="navigation__submenu level-3">
	                                                                                        <ul class="navigation__list -level-3">
	                                                                                            <ui:repeat varStatus="count" var="child2" value="#{child1.activeChildItems}">
	                                                                                                <h:panelGroup rendered="#{child2.valid and child2.shouldDisplay}">
	                                                                                                    <li class="#{!navItem.activeChildItems.isEmpty() ? 'navigation__submenu-trigger' : ''} #{navItem.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                                                                                        <!-- WITHOUT SUBMENU -->
	                                                                                                        <h:panelGroup rendered="#{child2.activeChildItems.isEmpty()}">
	                                                                                                            <component:navigationLink navItem="#{child2m}" />
	                                                                                                        </h:panelGroup>
	                                                                                                        <!-- WITH SUBMENU -->
	                                                                                                        <h:panelGroup rendered="#{!child2.activeChildItems.isEmpty()}">
	                                                                                                            <button
	                                                                                                                type="button"
	                                                                                                                class="btn btn--clean"
	                                                                                                                data-toggle="submenu">
	                                                                                                                #{msg[child2.itemLabel]}
	                                                                                                                <span class="caret"></span>
	                                                                                                            </button>
	                                                                                                        </h:panelGroup>
	                                                                                                        <h:panelGroup rendered="#{!child2.activeChildItems.isEmpty()}">
	                                                                                                            <!-- LEVEL 4 -->
	                                                                                                            <div class="navigation__submenu level-4">
	                                                                                                                <ul class="navigation__list -level-4">
	                                                                                                                    <ui:repeat varStatus="count" var="child3" value="#{child2.activeChildItems}">
	                                                                                                                        <h:panelGroup rendered="#{child3.valid and child3.shouldDisplay}">
	                                                                                                                            <li class="#{!navItem.activeChildItems.isEmpty() ? 'navigation__submenu-trigger' : ''} #{navItem.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                                                                                                                <!-- WITHOUT SUBMENU -->
	                                                                                                                                <h:panelGroup rendered="#{child3.activeChildItems.isEmpty()}">
	                                                                                                                                    <component:navigationLink navItem="#{child3}" />
	                                                                                                                                </h:panelGroup>
	                                                                                                                                <!-- WITH SUBMENU -->
	                                                                                                                                <h:panelGroup rendered="#{!child3.activeChildItems.isEmpty()}">
	                                                                                                                                    <button
	                                                                                                                                        type="button"
	                                                                                                                                        class="btn btn--clean"
	                                                                                                                                        data-toggle="submenu">
	                                                                                                                                        #{msg[child3.itemLabel]}
	                                                                                                                                        <span class="caret"></span>
	                                                                                                                                    </button>
	                                                                                                                                </h:panelGroup>
	                                                                                                                                <h:panelGroup rendered="#{!child3.activeChildItems.isEmpty()}">
	                                                                                                                                    <!-- LEVEL 5 -->
	                                                                                                                                    <div class="navigation__submenu level-5">
	                                                                                                                                        <ul class="navigation__list -level-5">
	                                                                                                                                            <ui:repeat varStatus="count" var="child4" value="#{child3.activeChildItems}">
	                                                                                                                                                <h:panelGroup rendered="#{child4.valid and child4.shouldDisplay}">
	                                                                                                                                                    <li class="#{!navItem.activeChildItems.isEmpty() ? 'navigation__submenu-trigger' : ''} #{navItem.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                                                                                                                                        <component:navigationLink navItem="#{child4}" />
	                                                                                                                                                    </li>
	                                                                                                                                                </h:panelGroup>
	                                                                                                                                            </ui:repeat>
	                                                                                                                                        </ul>
	                                                                                                                                    </div>
	                                                                                                                                </h:panelGroup>
	                                                                                                                            </li>
	                                                                                                                        </h:panelGroup>
	                                                                                                                    </ui:repeat>
	                                                                                                                </ul>
	                                                                                                            </div>
	                                                                                                        </h:panelGroup>
	                                                                                                    </li>
	                                                                                                </h:panelGroup>
	                                                                                            </ui:repeat>
	                                                                                        </ul>
	                                                                                    </div>
	                                                                                </h:panelGroup>
	                                                                            </li>
	                                                                        </h:panelGroup>
	                                                                    </ui:repeat>
	                                                                </ul>
	                                                            </div>
	                                                        </h:panelGroup>
	                                                    </li>
	                                                </h:panelGroup>
	                                            </ui:repeat>
	                                        </ul>
	                                    </div>
	                                </h:panelGroup>
	                            </li>
	                        </h:panelGroup>
	                    </ui:repeat>
	                </h:panelGroup>
	
	                <!-- MEGA MENU -->
	                <h:panelGroup rendered="#{cc.attrs.megaMenu == true}">
	                    <ui:repeat var="navItem" value="#{cmsBean.navigationMenuItems}">
	                        <h:panelGroup rendered="#{navItem.valid}">
	                            <li class="#{!navItem.childItems.isEmpty() ? 'navigation__megamenu-trigger' : ''} #{navItem.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                <!-- WITHOUT SUBMENU -->
	                                <h:panelGroup rendered="#{navItem.childItems.isEmpty()}">
	                                    <component:navigationLink navItem="#{navItem}" />
	                                </h:panelGroup>
	                                <!-- WITH SUBMENU -->
	                                <h:panelGroup rendered="#{!navItem.childItems.isEmpty()}">
	                                    <button type="button" class="btn btn--clean" data-toggle="megamenu">
	                                        #{msg[navItem.itemLabel]}
	                                        <span class="caret"></span>
	                                    </button>
	                                    <h:panelGroup rendered="#{!navItem.childItems.isEmpty()}">
	                                        <ui:param name="parentItem" value="#{navItem}" />
	
	                                        <div class="navigation__megamenu-wrapper">
	                                            <!-- CLOSE -->
	                                            <button type="button" class="navigation__megamenu-close btn btn--clean"
	                                                data-toggle="close" title="#{msg.close}">
	                                                <util:icon icon="x" />
	                                            </button>
	
	                                            <!-- LEVEL 1 -->
	                                            <div class="navigation__megamenu-element level-1">
	                                                <ul>
	                                                    <ui:repeat varStatus="count" var="child" value="#{parentItem.childItems}">
	                                                        <h:panelGroup rendered="#{child.valid}">
	                                                            <li class="navigation__megamenu-heading">
	                                                                <component:navigationLink navItem="#{child}" />
	                                                                
	                                                                <h:panelGroup rendered="#{!child.childItems.isEmpty()}">
	                                                                    <!-- LEVEL 2 -->
	                                                                    <div class="navigation__megamenu-element level-2">
	                                                                        <ul>
	                                                                            <ui:repeat varStatus="count" var="child1" value="#{child.childItems}">
	                                                                                <h:panelGroup rendered="#{child1.valid}">
	                                                                                    <li class="navigation__megamenu-item #{child1.matchesPage(navigationHelper.currentPage) ? 'active' : ''}">
	                                                                                        <component:navigationLink navItem="#{child1}" />
	                                                                                    </li>
	                                                                                </h:panelGroup>
	                                                                            </ui:repeat>
	                                                                        </ul>
	                                                                    </div>
	                                                                </h:panelGroup>
	                                                            </li>
	                                                        </h:panelGroup>
	                                                    </ui:repeat>
	                                                </ul>
	                                            </div>
	                                        </div>
	                                    </h:panelGroup>
	                                </h:panelGroup>
	                            </li>
	                        </h:panelGroup>
	                    </ui:repeat>
	                </h:panelGroup>
	            </ul>
	        </h:form>
	    </nav>
	
	    <script type="text/javascript">
	        var navigationConfig = {
	        		navigationSelector: ".navigation",
	                subMenuSelector: "##{cc.clientId} [data-toggle='submenu']",
	                megaMenuSelector: "##{cc.clientId}  [data-toggle='megamenu']",
	                closeMegaMenuSelector: "##{cc.clientId} [data-toggle='close']",
	        };
	        viewerJS.navigation.init(navigationConfig);
	    </script>
	</composite:implementation>
</ui:composition>

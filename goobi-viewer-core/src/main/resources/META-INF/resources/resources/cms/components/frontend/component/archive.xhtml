<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner"
	xmlns:composite="http://xmlns.jcp.org/jsf/composite"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
	xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
	template="/resources/themes/#{navigationHelper.theme}/template.html">

	<composite:interface>
		<composite:attribute name="component" required="true" />
	</composite:interface>

	<composite:implementation>

		<ui:fragment rendered="#{cc.attrs.component.hasAccess(userBean.user)}">

			<!-- CONTENT COMPONENT COLLECTION LIST -->
			<div
				class="tpl-archive content-component content-component__archive_tree
						-width-100 #{cc.attrs.component.isPrivate() and cc.attrs.component.hasAccess(userBean.user) ? '-isPrivate' : ''}">

				<div class="archives__tree-heading">
					<h2>#{msg.archives__archive_tree_heading}</h2>
					<button id="archivesSearchTrigger"
						class="#{not empty archiveBean.searchString ? '-active' : ''} btn"
						aria-label="#{msg.search}">
						<i class="fa fa-search"></i>
					</button>
				</div>
				
				<h:form>
					<h:commandScript name="reloadTree" render="#{cc.clientId}:archivesForm">
					</h:commandScript>
				</h:form>
				<script>
				viewerJS.jsfAjax.success.subscribe(data => {
					let shouldRefresh = data.source.classList.contains("archives-tree__expandable-icon") 
					|| data.source.classList.contains("archives-tree__expand-all-icon")
					|| data.source.classList.contains("archives__search-submit-button");
					if(shouldRefresh) {
						reloadTree();
					}
				});
				</script>
				
				
				<h:panelGroup layout="block" id="treeGroup"
					styleClass="archives__graphic-tree">
					<div
						class="archives__search-input-wrapper #{not empty archiveBean.searchString ? '-isNotEmpty' : ''}">
						<h:form id="searchForm" prependId="false">
							<h:inputText id="archivesSearchField"
								styleClass="form-control filter-input archives__search-input"
								value="#{archiveBean.searchString}" immediate="true">
								<f:passThroughAttribute name="placeholder"
									value="#{msg.searchFieldDemoText}" />
								<f:passThroughAttribute name="aria-label"
									value="#{msg.aria_label__search_form}" />
							</h:inputText>
							<div
								class="archives__search-clear #{not empty archiveBean.searchString ? '-isNotEmpty' : ''}">x</div>
							<h:commandButton styleClass="archives__search-submit-button"
								value="#{msg.search}" action="#{archiveBean.searchAction}">
								<f:ajax execute="@form" render="@none"/>
							</h:commandButton>
						</h:form>
					</div>
					<ui:include
						src="/resources/includes/archives/archiveTreeView.xhtml">
						<ui:param name="indent"
							value="#{configurationBean.tocIndentation * 1.5}" />
						<ui:param name="renderOnExpand"
							value="@none" />
					</ui:include>

				</h:panelGroup>

				<script type="text/javascript">
		        	viewerJS.archives.init({
		                initHcSticky: false,
		                initSearch: true,
		                initTextTree: false,
		        });
		        </script>

			</div>

		</ui:fragment>


	</composite:implementation>

</ui:composition>